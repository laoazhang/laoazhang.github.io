<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Web Notifications Update &#8211; Laoazhang! Blog</title>
<meta name="description" content="">
<meta name="keywords" content="">

<!-- Twitter cards -->
<meta name="twitter:site"    content="@laoazhang">
<meta name="twitter:creator" content="@laoazhang">


<meta name="twitter:card"  content="summary">
<meta name="twitter:image" content="https://laoazhang.cn/assets/images/avatar.jpg">



<meta name="twitter:title"   content="Web Notifications Update">



<meta name="twitter:description" content="If you only do what you can do, you will never be more than you are now">


<!-- end of Twitter cards -->

<!-- Web Monetization | Interledger -->
<meta name="monetization" content="$ilp.uphold.com/6NxbkHNq9N84">
<meta name="monetization" content="$twitter.xrptipbot.com/laoazhang" />

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Web Notifications Update">
<meta property="og:description" content="If you only do what you can do, you will never be more than you are now">
<meta property="og:url" content="https://laoazhang.cn/blog/2014/03/21/notifications/">
<meta property="og:site_name" content="Laoazhang! Blog">

<!-- Webmaster Tools verfication -->
<meta name="google-site-verification" content="I-NDFBl5t1P9fqHmRNZhwu8OOHmwW4HADPiOr_r16cE">



<link rel="canonical" href="https://laoazhang.cn/blog/2014/03/21/notifications/">
<link href="https://laoazhang.cn/feed.xml" type="application/atom+xml" rel="alternate" title=" Feed">


<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Google Webfonts -->
<link href='//fonts.googleapis.com/css?family=Open+Sans:400italic,400,600,700' rel='stylesheet' type='text/css'>

<!-- For all browsers -->
<link rel="stylesheet" href="https://laoazhang.cn/assets/css/main.min.css">

<!--[if (lt IE 9) & (!IEMobile)]>
<link rel="stylesheet" href="https://laoazhang.cn/assets/css/ie.min.css">
<![endif]-->

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="https://laoazhang.cn/assets/js/vendor/modernizr/modernizr.js"></script>

<!-- Icons -->

<!-- favicon -->
<link rel="shortcut icon" href="https://laoazhang.cn/assets/ico/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="https://laoazhang.cn/assets/ico/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://laoazhang.cn/assets/ico/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://laoazhang.cn/assets/ico/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://laoazhang.cn/assets/ico/apple-touch-icon-144x144-precomposed.png">

</head>

<body class="article" itemscope itemtype="https://schema.org/WebPage">

<!--[if lt IE 9]><div class="browser-upgrade alert alert-info">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div><![endif]-->

<div class="navigation-wrapper">
	<div class="site-name">
		<a href="https://laoazhang.cn/index.html">Laoazhang.cn</a>
	</div><!-- /.site-name -->
	<div class="top-navigation">
		<nav role="navigation" itemscope itemtype="https://schema.org/SiteNavigationElement">
		    <ul>
		        
				<li><a href="https://laoazhang.cn/about" >About</a></li>
		        
				<li><a href="https://laoazhang.cn/blog" >Archive</a></li>
		        
				<li><a href="https://laoazhang.cn/presentations" >Preso</a></li>
		        
				<li><a href="https://laoazhang.cn/doodles" >Sketch Notes</a></li>
		        
				<li><a href="https://codepen.io/laoazhang" target="_blank">My CodePen</a></li>
		        
		        <li><i class="icon-feed"></i> <a href="https://laoazhang.cn/feed.xml" title="Atom/RSS feed">Feed</a>
		    </ul>
		</nav>
	</div><!-- /.top-navigation -->
</div><!-- /.navigation-wrapper -->


<header role="banner">
</header>

<div id="main" role="main" itemprop="mainContentOfPage" itemscope itemtype="https://schema.org/Blog">
  <div class="article-author-side">
  	<img src="https://laoazhang.cn/assets/images/avatar.jpg" class="bio-photo" alt="laoazhang">
    <h3>laoazhang</h3>
<p class="bio">An Open Web advocate and front-end engineer, who loves everything mobile, and writes about HTML5, CSS, JS, UX, tech events, gadgets, etc. She unintentionally got 15min of fame by creating The HTTP Status Cats. Also, the opinions expressed here are solely her own and do not express the views or opinions of my employer.</p>
<a href="https://twitter.com/laoazhang" class="author-social" target="_blank"><i class="icon-twitter"></i> Twitter</a>
<a href="https://facebook.com/laoazhang" class="author-social" target="_blank"><i class="icon-facebook"></i> Facebook</a>

<a href="https://linkedin.com/in/laoazhang" class="author-social" target="_blank"><i class="icon-linkedin"></i> LinkedIn</a>
<a href="https://instagram.com/laoazhang" class="author-social" target="_blank"><i class="icon-instagram"></i> Instagram</a>
<a href="https://github.com/laoazhang" class="author-social" target="_blank"><i class="icon-github"></i> Github</a>




        <p class="license">
      
    </p>

  </div>

  <article itemscope itemtype="http://schema.org/BlogPosting" itemprop="blogPost">
    <div class="headline-wrap">
      
      <time datetime="2014-03-21T00:00:00-07:00" itemprop="datePublished"><i class="icon-calendar"></i> March 21, 2014</time>

      
      <h1 itemprop="name">Web Notifications Update</h1>
      <h2></h2>
    </div><!--/ .headline-wrap -->

    <div class="article-wrap" itemprop="text">
      <p><img src="/assets/images/articles/2014/03/notifications.png" alt="screenshot" title="Web notification" /></p>

<p>Two years ago, I <a href="http://girliemac.com/blog/2012/03/29/creating-non-disruptive-notifications-with-html5/">wrote a demo and blogged</a> about then-Chrome-only HTML5 notifications. A while ago, like, 8 Chrome versions ago, Iâ€™ve noticed the demo no longer worked, because the <a href="http://www.chromium.org/developers/design-documents/desktop-notifications/api-specification">original specication</a> I was using was deprecated for good.</p>

<p>Around the time, started by Apple first, each browser vendors had its own proprietary notifications API, then last year, they have decided to standardized specification.</p>

<p>I finally read the <a href="http://www.w3.org/TR/notifications">new specifications on W3C</a> recently, and rewrote the demo using the standard API.</p>

<h2 id="new-and-simplified-specs">New and Simplified Specs</h2>

<p>In the original demo, I implemented the notifications in <em>webOS 3.0-style</em> UX, which allowed a user to swipe to close the window. (Do you remember HP TouchPad, which was killed soon after the release and gone on fire-sale? I was a UI engineer for the beautiful dead platform.) However, <a href="http://girliemac.com/html5-notifications-webOS-style/">this v2 demo</a> no longer supports the swipable notifications UI because the simplified new Web Notifications spcification only allows text and icon, and external HTML (with JS) files are no longer permitted.</p>

<h2 id="demo">Demo</h2>

<p>Check out the new demo: <a href="http://girliemac.com/html5-notifications-webOS-style/">http://girliemac.com/html5-notifications-webOS-style</a> (I keep the webOS system config look-and-feel!)</p>

<p>The simplified standard uses <code class="language-plaintext highlighter-rouge">Notification</code> object to represent each notification. (No <code class="language-plaintext highlighter-rouge">webkit</code> or <code class="language-plaintext highlighter-rouge">moz</code> vendor prefixes are required for the supported browsers.)</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">notification</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Notification</span><span class="p">(</span><span class="dl">'</span><span class="s1">YOLO!</span><span class="dl">'</span><span class="p">);</span>
</code></pre></div></div>

<h3 id="request-permission">Request Permission</h3>

<p><img src="/assets/images/articles/2014/03/permission.png" alt="screenshot" title="Web notification" /></p>

<p>Notifications can only be displayed if the user has granted permission. Requesting the user agent to ask a user for permission is done as follows:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">Notification</span><span class="p">.</span><span class="nf">requestPermission</span><span class="p">(</span><span class="nx">callback</span><span class="p">);</span>
</code></pre></div></div>

<p>This process is done asynchronously, and the callback function is called when the user chooses a permission either <code class="language-plaintext highlighter-rouge">default</code>, <code class="language-plaintext highlighter-rouge">granted</code>, or <code class="language-plaintext highlighter-rouge">denied</code>.</p>

<h3 id="displaying-notifications">Displaying Notifications</h3>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if </span><span class="p">(</span><span class="nx">Notification</span><span class="p">.</span><span class="nx">permission</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">granted</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">n</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Notification</span><span class="p">(</span><span class="dl">'</span><span class="s1">Meeting</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>  
    <span class="na">body</span><span class="p">:</span> <span class="dl">'</span><span class="s1">March 21 3:30 PM</span><span class="dl">'</span><span class="p">,</span>
	<span class="na">icon</span><span class="p">:</span> <span class="dl">'</span><span class="s1">calendar.png</span><span class="dl">'</span> 
  <span class="p">});</span>
<span class="p">}</span>
</code></pre></div></div>

<p><img src="/assets/images/articles/2014/03/notification-window.png" alt="screenshot" title="Notifications on Chrome" /></p>

<h3 id="events">Events</h3>

<p><code class="language-plaintext highlighter-rouge">Notification</code> fires <code class="language-plaintext highlighter-rouge">show</code> and <code class="language-plaintext highlighter-rouge">close</code> events during the lifecycle.</p>

<p>To close the notification window after 15 seconds:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">n</span><span class="p">.</span><span class="nx">onshow</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> 
  <span class="nf">setTimeout</span><span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">close</span><span class="p">,</span> <span class="mi">15000</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="supported-browsers">Supported Browsers</h2>

<ul>
  <li>Firefox 22+ (both desktop and mobile)</li>
  <li>Chrome 32+ (Desktop only)</li>
  <li>Safari 6+ on Mac 10.8+ (Damnit, I need to upgrade my Mac to test!)</li>
</ul>

<p>As long as I tested, the web notifications API is disabled on Chrome for mobile, while Firefox does support the feature (however, it has a UI issue).</p>

<h2 id="known-problems">Known Problems</h2>

<ul>
  <li>Chrome for Android does not support the feature</li>
  <li>Firefox on Android does support, however, only one line (the last line) is displayed on the native notification bar on top. No extra UI or window from browser. (tested on Firefox 29. Bug filed #986785.)</li>
  <li>On Chrome (tested on 33), <code class="language-plaintext highlighter-rouge">close()</code> method does not seem to work. Notification windows fails to close automatically. (Bug filed #355214).</li>
</ul>

<h3 id="firefox-on-android">Firefox on Android</h3>

<p>Notifications appear in the native notification bar, one at a time, instead of popup windows from browser.</p>

<p>The problem is that if a notificatin contains more than one lines one messages (when both main text and <code class="language-plaintext highlighter-rouge">body</code> are set), only the last line (<code class="language-plaintext highlighter-rouge">body</code>) is displayed, instead of the main title, which I think makes more sense. When the notification bar is expanded by a user, both subject and body text are visible (See the screenshot below).</p>

<p>Also, custom icons arenâ€™t shown either. The icon on the notification is always Firefox icon.</p>

<p><img src="/assets/images/articles/2014/03/notifications-moz.png" alt="screenshot" title="Notifications from Firefox on Android" /></p>

<h2 id="references">References</h2>

<ul>
  <li>W3C <a href="http://www.w3.org/TR/notifications">Web Notifications</a></li>
  <li>WHATWG <a href="http://notifications.spec.whatwg.org/">Notifications AP</a></li>
  <li>Can I use <a href="http://caniuse.com/notifications">Web Notifications</a>?</li>
  <li>MDN <a href="https://developer.mozilla.org/en-US/docs/WebAPI/Using_Web_Notifications">Using Web Notifications</a></li>
  <li>Apple Safari Developer Library <a href="https://developer.apple.com/library/safari/documentation/AppleApplications/Conceptual/SafariJSProgTopics/Articles/SendingNotifications.html">Sending Notifications</a></li>
</ul>


      <hr>

      <!-- Pagination -->
      <ul class="pagination">
	      
	        <li class="prev"><a href="/blog/2014/03/02/filterous/" rel="prev">&larr; Filtrous.js Photo Manipulation Library</a></li>
	      
	      
	        <li class="next"><a href="/blog/2014/07/03/indexeddb/" rel="next">IndexedDB is finally something &rarr;</a></li>
	      
	  </ul>

      <hr style="visibility:hidden;">

      <!-- Categories -->
      
	  <ul class="categories">
	      <li><i class="icon-drawer"></i></li>
	      

	      
		    
		    	<li data-size="44"><a href="/categories/#Dev">
		    		Dev
		    	</a></li>
		    
		    	<li data-size="21"><a href="/categories/#HTML5">
		    		HTML5
		    	</a></li>
		    
		    	<li data-size="5"><a href="/categories/#Javascript">
		    		Javascript
		    	</a></li>
		    
		    	<li data-size="6"><a href="/categories/#mobile">
		    		mobile
		    	</a></li>
		    
		    	<li data-size="5"><a href="/categories/#firefox">
		    		firefox
		    	</a></li>
		    
		    	<li data-size="3"><a href="/categories/#Chrome">
		    		Chrome
		    	</a></li>
		    
		  
	      

	  </ul>
	  

	  <!-- Disqus -->
	      <div id="disqus_thread" style="margin-top: 3em"></div>
		    <script type="text/javascript">
		        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
		        var disqus_shortname = 'laoazhang'; // required: replace example with your forum shortname
				

		        /* * * DON'T EDIT BELOW THIS LINE * * */
		        (function() {
		            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
		            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
		        })();
		    </script>
		    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
		    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">

    </div><!-- /.article-wrap -->
  </article>
</div><!-- /#main -->

<footer>
  <small class="copyright">
    <span>&copy; 2024 laoazhang. Powered by <a href="http://jekyllrb.com">Jekyll</a> with modified <em>Minimal Mistakes</em> theme. Hosted on <a href="http://github.com">Github</a>.
  </small>
</footer>

<script src="https://laoazhang.cn/assets/js/scripts.min.js"></script>

<!-- Asynchronous Google Analytics snippet -->
<script>
  var _gaq = _gaq || [];
  var pluginUrl = 
 '//www.google-analytics.com/plugins/ga/inpage_linkid.js';
  _gaq.push(['_require', 'inpage_linkid', pluginUrl]);
  _gaq.push(['_setAccount', 'UA-2635445-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>


<script>

</script>

</body>
</html>
