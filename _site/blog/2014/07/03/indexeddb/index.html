<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>IndexedDB is finally something &#8211; Laoazhang! Blog</title>
<meta name="description" content="">
<meta name="keywords" content="">

<!-- Twitter cards -->
<meta name="twitter:site"    content="@laoazhang">
<meta name="twitter:creator" content="@laoazhang">


<meta name="twitter:card"  content="summary">
<meta name="twitter:image" content="https://laoazhang.cn/assets/images/avatar.jpg">



<meta name="twitter:title"   content="IndexedDB is finally something">



<meta name="twitter:description" content="If you only do what you can do, you will never be more than you are now">


<!-- end of Twitter cards -->

<!-- Web Monetization | Interledger -->
<meta name="monetization" content="$ilp.uphold.com/6NxbkHNq9N84">
<meta name="monetization" content="$twitter.xrptipbot.com/laoazhang" />

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="IndexedDB is finally something">
<meta property="og:description" content="If you only do what you can do, you will never be more than you are now">
<meta property="og:url" content="https://laoazhang.cn/blog/2014/07/03/indexeddb/">
<meta property="og:site_name" content="Laoazhang! Blog">

<!-- Webmaster Tools verfication -->
<meta name="google-site-verification" content="I-NDFBl5t1P9fqHmRNZhwu8OOHmwW4HADPiOr_r16cE">



<link rel="canonical" href="https://laoazhang.cn/blog/2014/07/03/indexeddb/">
<link href="https://laoazhang.cn/feed.xml" type="application/atom+xml" rel="alternate" title=" Feed">


<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Google Webfonts -->
<link href='//fonts.googleapis.com/css?family=Open+Sans:400italic,400,600,700' rel='stylesheet' type='text/css'>

<!-- For all browsers -->
<link rel="stylesheet" href="https://laoazhang.cn/assets/css/main.min.css">

<!--[if (lt IE 9) & (!IEMobile)]>
<link rel="stylesheet" href="https://laoazhang.cn/assets/css/ie.min.css">
<![endif]-->

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="https://laoazhang.cn/assets/js/vendor/modernizr/modernizr.js"></script>

<!-- Icons -->

<!-- favicon -->
<link rel="shortcut icon" href="https://laoazhang.cn/assets/ico/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="https://laoazhang.cn/assets/ico/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://laoazhang.cn/assets/ico/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://laoazhang.cn/assets/ico/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://laoazhang.cn/assets/ico/apple-touch-icon-144x144-precomposed.png">

</head>

<body class="article" itemscope itemtype="https://schema.org/WebPage">

<!--[if lt IE 9]><div class="browser-upgrade alert alert-info">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div><![endif]-->

<div class="navigation-wrapper">
	<div class="site-name">
		<a href="https://laoazhang.cn/index.html">Laoazhang.cn</a>
	</div><!-- /.site-name -->
	<div class="top-navigation">
		<nav role="navigation" itemscope itemtype="https://schema.org/SiteNavigationElement">
		    <ul>
		        
				<li><a href="https://laoazhang.cn/about" >About</a></li>
		        
				<li><a href="https://laoazhang.cn/blog" >Archive</a></li>
		        
				<li><a href="https://laoazhang.cn/presentations" >Preso</a></li>
		        
				<li><a href="https://laoazhang.cn/doodles" >Sketch Notes</a></li>
		        
				<li><a href="https://codepen.io/laoazhang" target="_blank">My CodePen</a></li>
		        
		        <li><i class="icon-feed"></i> <a href="https://laoazhang.cn/feed.xml" title="Atom/RSS feed">Feed</a>
		    </ul>
		</nav>
	</div><!-- /.top-navigation -->
</div><!-- /.navigation-wrapper -->


<header role="banner">
</header>

<div id="main" role="main" itemprop="mainContentOfPage" itemscope itemtype="https://schema.org/Blog">
  <div class="article-author-side">
  	<img src="https://laoazhang.cn/assets/images/avatar.jpg" class="bio-photo" alt="laoazhang">
    <h3>laoazhang</h3>
<p class="bio">An Open Web advocate and front-end engineer, who loves everything mobile, and writes about HTML5, CSS, JS, UX, tech events, gadgets, etc. She unintentionally got 15min of fame by creating The HTTP Status Cats. Also, the opinions expressed here are solely her own and do not express the views or opinions of my employer.</p>
<a href="https://twitter.com/laoazhang" class="author-social" target="_blank"><i class="icon-twitter"></i> Twitter</a>
<a href="https://facebook.com/laoazhang" class="author-social" target="_blank"><i class="icon-facebook"></i> Facebook</a>

<a href="https://linkedin.com/in/laoazhang" class="author-social" target="_blank"><i class="icon-linkedin"></i> LinkedIn</a>
<a href="https://instagram.com/laoazhang" class="author-social" target="_blank"><i class="icon-instagram"></i> Instagram</a>
<a href="https://github.com/laoazhang" class="author-social" target="_blank"><i class="icon-github"></i> Github</a>




        <p class="license">
      
    </p>

  </div>

  <article itemscope itemtype="http://schema.org/BlogPosting" itemprop="blogPost">
    <div class="headline-wrap">
      
      <time datetime="2014-07-03T00:00:00-07:00" itemprop="datePublished"><i class="icon-calendar"></i> July 03, 2014</time>

      
      <h1 itemprop="name">IndexedDB is finally something</h1>
      <h2></h2>
    </div><!--/ .headline-wrap -->

    <div class="article-wrap" itemprop="text">
      <p><img src="/assets/images/articles/2014/07/coremob-camera-idb.png" alt="screenshot" title="IndexedDB in Coremob Camera app" />
“Woo-hoo, finally!!!” (I should stop being grumpy!)</p>

<p>This was the first reaction I had when I heard the new on Twitter about Chromium started supporting blob on IndexedDB. And now I know it is official after seeing the <a href="http://updates.html5rocks.com/2014/07/Blob-support-for-IndexedDB-landed-on-Chrome-Dev">blog post on HTML5 Rocks</a> by a Chrome developer advocate, also a good friend of mine, Eiji Kitamura.</p>

<p>Why was I so excited? Because I have been waited this for 1.5 years since I started writing <strong>Coremob Camera</strong>. When I started this project, IndexedDB support was super spotty, and I felt Firefox for Android was my only friend who listened to me. (FirefoxOS wasn’t quite there yet).</p>

<h2 id="coremob-camera">Coremob Camera</h2>

<p>If you have seen me talking at conferences before, you may have heard about Coremob Camera, the open web standards project I was working on, although I failed to thoroughly document it.</p>

<p><a href="https://github.com/coremob/camera/">Coremob Camera</a> is a web project that mostly I and Tobie Langel worked on for W3C’s Core Mobile Community Group (now <a href="http://www.w3.org/Mobile/IG/">Web and Mobile Interest Group</a>) to showcase the capability of the web platform, especially on mobile devices. We were hoping to help web developers out there to learn about HTML5 use cases, as well as help improve web browsers.</p>

<h2 id="the-state-of-indexeddb">The State of IndexedDB</h2>

<p>One of the key features we focused as a real-life use case is <a href="http://www.w3.org/TR/IndexedDB/">IndexedDB</a>. The good new was that Internet Explorer 10 supported IndexedDB. The bad news was that Safari had no plan of supporting it, also IndexedDB API was pretty new and unstable at that time the project started. Actually, bad news overwhelmed the good news.</p>

<p>I talked about my agony at <strong>W3Conf</strong> (<a href="https://www.youtube.com/watch?v=3Afi-v-m_Gc">video</a>) last year, then bitterly joked about complete lack of support by Apple, and IndexedDB was not ready to use, at <strong>All Your Base Conf</strong> (<a href="https://vimeo.com/83837733">video</a>, Also the slides below).</p>

<script async="" class="speakerdeck-embed" data-id="bda5d8c019b201318b443620859eaef1" data-ratio="1.6" src="//speakerdeck.com/assets/embed.js"></script>

<p>My biggest tormenters were:</p>

<ul>
  <li>No adequate browser support (missing in Safari, Android stock, Presto-Opera)</li>
  <li>Vendor prefix</li>
  <li>Chaotic coexistence of deprecated specs and new specs on supported browsers
    <ul>
      <li><code class="language-plaintext highlighter-rouge">setVersion()</code> vs. <code class="language-plaintext highlighter-rouge">onupgradeneeded</code></li>
      <li><code class="language-plaintext highlighter-rouge">IDBTransaction.READ_WRITE</code> vs. <code class="language-plaintext highlighter-rouge">"readwrite"</code></li>
      <li>Chrome uses string for version instead of number</li>
    </ul>
  </li>
  <li>No blob support (Only Firefox supported)</li>
</ul>

<p>The specifications have been modified multiple times. For example with Firefox’s case, the basic iDB support started in version 4, <code class="language-plaintext highlighter-rouge">setVersion()</code> was deprecated at ver 10, and transaction mode has been switched to string from constant since 13. For mobile support (Firefox’s earliest Android support was ver 16-ish), I could just stick with the latest specs; however, Chrome came to the iDB space later with slightly older specifications.</p>

<p>Because I never knew which specifications and features were supported on what browsers, also annoying issue such as Chrome’s silent failure when trying to store blobs, I had to use a bunch of feature detections and  <code class="language-plaintext highlighter-rouge">try</code> / <code class="language-plaintext highlighter-rouge">catch</code> for fail-proof for the buggy Chrome 18 and Blackberry 10 (which was less PITA than Chrome).</p>

<h3 id="chromes-fashionably-late-mobile-debut">Chrome’s Fashionably Late Mobile Debut</h3>

<p>It’s 2014 now, and this year’s Google I/O was all about Android-
It is almost unbelievable for you when I say Chrome was fashionably late to the Android party. But the truth is, Chrome was not even available until late 2012, at version 18.</p>

<p>Despite the fact that Google ships Chrome quite often (along with Beta, Dev, and Canary nightly release) for desktop, I never could have any updates for my Nexus 4, during the time of the Coremob Camera development. After I patiently waited, good news came to me finally in March 2013. It was Chrome 25! Yes, there was a big gap between 18 and 25.</p>

<p>Ever since, Google constantly releases Beta version for Android as well.</p>

<h3 id="awesome-chrome-dev-tools">Awesome Chrome Dev Tools</h3>

<p>Besides the lack of blob supports, I have been always a big fan of Chrome’s <em>DevTools</em>. As well as DOM and CSS debugging, and monitoring performance, you can inspect web storages too. Visualizing the contents in your IndexedDB is easy with Chrome.</p>

<p><img src="/assets/images/articles/2014/07/devtools.gif" alt="devtools" title="Inspect iDB on Chrome DevTools" /></p>

<h2 id="to-blob-or-not-to-blob">To Blob or Not to Blob</h2>

<p>Blob support was somehow important for me, because Coremob Camera is all about photos. In the app scenario, the user flow is as follows:</p>

<ol>
  <li>Take a picture via <strong>HTML Media Capture</strong></li>
  <li>Use <code class="language-plaintext highlighter-rouge">FileReader()</code> to return the picture as an object</li>
  <li><code class="language-plaintext highlighter-rouge">drawImage()</code> to draw the image object in canvas</li>
  <li><code class="language-plaintext highlighter-rouge">getImageData()</code> to get an ImageData object containing a copy of the pixel data, then alter the pixels</li>
  <li>Store the <strong>blob</strong> locally with <strong>IndexedDB</strong></li>
  <li>Upload the final photo with <strong>XHR2</strong> over <strong>CORS</strong></li>
</ol>

<p>(Whoa, I successfully gave you a bunch of HTML5 use cases in a single web app, right!?)</p>

<p>For the step 5, since only Firefox was supporting blob in IndexedDB, I had to use Base64 data URL strings for unsupported browsers. Me, grumpy grumpy.</p>

<h2 id="good-news-and-more-good-news">Good news and more good news</h2>

<p>So, I felt like it has been a long time (a long InterWeb years) since I started using IndexedDB experimentally.</p>

<p><img src="/assets/images/articles/2014/07/wwdc.png" alt="WWDC" title="Safari 8" /></p>

<p>At this year’s WWDC, Apple announced new features coming to Safari 8, including yes, IndexedDB support!</p>

<p>And I am delighted with the arrival of Chrome 37, which has blob support for IndexedDB!</p>

<p>IndexedDB is finally something.</p>

<p><img src="/assets/images/articles/2014/07/cry.png" alt="yes" title="Finally!" /></p>

<p>Note: Currently, Chrome 37 (Dev) is not available on Android yet! Until then, you can try <a href="http://coremob.github.io/camera/vanilla/index.html">Coremob Camera</a> on desktop!</p>

<h2 id="references">References</h2>

<ul>
  <li>W3C <a href="http://www.w3.org/TR/IndexedDB/">Indexed Database API</a></li>
  <li>Can I use <a href="http://caniuse.com/indexeddb">IndexedDB?</a>?</li>
</ul>


      <hr>

      <!-- Pagination -->
      <ul class="pagination">
	      
	        <li class="prev"><a href="/blog/2014/03/21/notifications/" rel="prev">&larr; Web Notifications Update</a></li>
	      
	      
	        <li class="next"><a href="/blog/2014/07/28/devicemode/" rel="next">Responsive Web Made Easier with Chrome DevTools Device Mode &rarr;</a></li>
	      
	  </ul>

      <hr style="visibility:hidden;">

      <!-- Categories -->
      
	  <ul class="categories">
	      <li><i class="icon-drawer"></i></li>
	      

	      
		    
		    	<li data-size="44"><a href="/categories/#Dev">
		    		Dev
		    	</a></li>
		    
		    	<li data-size="21"><a href="/categories/#HTML5">
		    		HTML5
		    	</a></li>
		    
		    	<li data-size="5"><a href="/categories/#Javascript">
		    		Javascript
		    	</a></li>
		    
		    	<li data-size="6"><a href="/categories/#mobile">
		    		mobile
		    	</a></li>
		    
		    	<li data-size="5"><a href="/categories/#firefox">
		    		firefox
		    	</a></li>
		    
		    	<li data-size="3"><a href="/categories/#Chrome">
		    		Chrome
		    	</a></li>
		    
		  
	      

	  </ul>
	  

	  <!-- Disqus -->
	      <div id="disqus_thread" style="margin-top: 3em"></div>
		    <script type="text/javascript">
		        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
		        var disqus_shortname = 'laoazhang'; // required: replace example with your forum shortname
				

		        /* * * DON'T EDIT BELOW THIS LINE * * */
		        (function() {
		            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
		            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
		        })();
		    </script>
		    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
		    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">

    </div><!-- /.article-wrap -->
  </article>
</div><!-- /#main -->

<footer>
  <small class="copyright">
    <span>&copy; 2024 laoazhang. Powered by <a href="http://jekyllrb.com">Jekyll</a> with modified <em>Minimal Mistakes</em> theme. Hosted on <a href="http://github.com">Github</a>.
  </small>
</footer>

<script src="https://laoazhang.cn/assets/js/scripts.min.js"></script>

<!-- Asynchronous Google Analytics snippet -->
<script>
  var _gaq = _gaq || [];
  var pluginUrl = 
 '//www.google-analytics.com/plugins/ga/inpage_linkid.js';
  _gaq.push(['_require', 'inpage_linkid', pluginUrl]);
  _gaq.push(['_setAccount', 'UA-2635445-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>


<script>

</script>

</body>
</html>
